name: Hubspot IA Agent ‚Äî Patched

on:
  workflow_dispatch:
  schedule:
    - cron: '0 06 * * *'  # 06:00 UTC (ajuste conforme necess√°rio)

jobs:
  run-all:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4

      - name: üêç Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: üì¶ Instalar depend√™ncias Python
        run: |
          python -m pip install --upgrade pip
          pip install playwright gspread oauth2client

      - name: üß≠ Instalar Playwright (com depend√™ncias do SO)
        run: |
          python -m playwright install --with-deps chromium

      - name: üîê Criar credenciais do Google (service account)
        run: |
          echo "${{ secrets.GSHEETS_KEY_B64 }}" > gsheets_key.b64

      - name: ‚ñ∂Ô∏è Rodar scraper (robusto)
        env:
          GSHEETS_KEY_B64: ${{ secrets.GSHEETS_KEY_B64 }}
          SHEET_NAME: ${{ vars.SHEET_NAME }}
          SHEET_TAB: ${{ vars.SHEET_TAB }}
          BLOG_URL: ${{ vars.BLOG_URL }}
          KEYWORDS: ${{ vars.KEYWORDS }}
        run: |
          python playwright_scraper_patched.py

      - name: ‚ñ∂Ô∏è Processar prompts (se houver novos)
        env:
          GSHEETS_KEY_B64: ${{ secrets.GSHEETS_KEY_B64 }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python processar_prompts.py
